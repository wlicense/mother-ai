# マザーAI - 開発進捗管理

## 統合ページ管理表

### ゲスト向けページ

| ID | ページ名 | ルート | 権限レベル | 統合機能 | 着手 | 完了 |
|----|---------|-------|----------|---------|------|------|
| P-001 | ランディングページ | `/` | ゲスト | サービス説明、デモ動画、申請CTA | × | × |
| P-002 | 申請フォーム | `/apply` | ゲスト | 基本情報入力、利用目的記入、OAuth連携 | × | × |
| P-003 | ログインページ | `/login` | ゲスト | メール/PW認証、OAuth認証 | × | × |

### 一般ユーザー向けページ

| ID | ページ名 | ルート | 権限レベル | 統合機能 | 着手 | 完了 |
|----|---------|-------|----------|---------|------|------|
| P-004 | プロジェクト一覧・管理 | `/projects` | 一般ユーザー | 一覧表示、新規作成、削除、進捗可視化 | × | × |
| P-005 | AI対話・プロジェクト開発 | `/projects/:id` | 一般ユーザー | PhaseカードUI、AIチャット、コード生成、Monaco Editor、デプロイ | × | × |
| P-006 | マイプロフィール・設定 | `/profile` | 一般ユーザー | プロフィール編集、APIキー設定、使用量確認 | × | × |
| P-007 | 審査待ちページ | `/pending` | 申請中ユーザー | 審査中メッセージ、問い合わせ先 | × | × |

### 管理者向けページ

| ID | ページ名 | ルート | 権限レベル | 統合機能 | 着手 | 完了 |
|----|---------|-------|----------|---------|------|------|
| A-001 | 申請審査ダッシュボード | `/admin/applications` | 管理者 | 申請一覧、承認/却下、メール通知、統計 | × | × |
| A-002 | ユーザー・プロジェクト管理 | `/admin/users` | 管理者 | ユーザー一覧、プロジェクト監視、ステータス変更、スパム検出 | × | × |
| A-003 | API監視ダッシュボード | `/admin/api-monitor` | 管理者 | リアルタイム使用量、アラート設定、コスト分析 | × | × |

### 後期拡張予定（マザーAI自身が実装）

| ID | ページ名 | 実装タイミング | 統合機能 |
|----|---------|--------------|---------|
| A-004 | システム設定 | 本格運用時 | 料金プラン設定、機能フラグ、全体設定 |
| P-008 | プロジェクトテンプレート | ユーザー要望時 | テンプレート共有、公開ポートフォリオ |
| P-009 | チーム協業 | チーム機能要望時 | 複数人プロジェクト、権限管理 |
| P-010 | 統計ダッシュボード | ユーザー要望時 | 詳細な利用統計、分析 |

---

## Phase管理表（MVP）

### コアPhase（10-14日で実装）

| Phase番号 | Phase名 | エージェント | 主要機能 | 着手 | 完了 |
|----------|--------|------------|---------|------|------|
| Phase 1 | 要件定義 | 要件定義エージェント | ユーザーとの対話で要件を引き出す | [ ] | [ ] |
| Phase 2 | コード生成 | コード生成エージェント | React + FastAPI コード自動生成 | [ ] | [ ] |
| Phase 3 | デプロイ | デプロイエージェント | Vercel + GCRへ自動デプロイ | [ ] | [ ] |
| Phase 4 | 自己改善 | 自己改善エージェント | マザーAI自身の改善・拡張 | [ ] | [ ] |

### 後期Phase（マザーAI自身が追加）

| Phase番号 | Phase名 | 実装タイミング | 主要機能 |
|----------|--------|--------------|---------|
| Phase 5 | テスト | ユーザー要望時 | 自動テスト生成・実行 |
| Phase 6 | リファクタリング | コード品質要望時 | コード品質改善 |
| Phase 7 | ドキュメント生成 | ドキュメント要望時 | 自動ドキュメント作成 |
| Phase 8-14+ | 拡張Phase | 必要に応じて | ユーザーニーズに応じた無限拡張 |

---

## バックエンド実装計画

### 2.1 垂直スライス実装順序

| 順序 | スライス名 | 主要機能 | エンドポイント | 依存スライス | 完了 |
|------|-----------|---------|-------------|-------------|------|
| 1 | 認証基盤 | ログイン/登録/ユーザー情報取得 | POST /auth/login, POST /auth/register, GET /users/me | なし | [ ] |
| 2-A | 申請管理（管理者） | 申請承認・却下 | GET /admin/applications, PUT /admin/applications/{id}/approve, PUT /admin/applications/{id}/reject | 1 | [ ] |
| 2-B | プロジェクト管理 | プロジェクトCRUD | POST /projects, GET /projects, GET /projects/{id}, DELETE /projects/{id} | 1 | [ ] |
| 3-A | AI対話機能 | メッセージ送受信（SSE） | POST /projects/{id}/messages, GET /projects/{id}/messages | 2-B | [ ] |
| 3-B | ユーザープロフィール | プロフィール更新 | PUT /users/me | 1 | [ ] |
| 4-A | OAuth認証 | Google/GitHub認証 | POST /auth/oauth/{provider} | 1 | [ ] |
| 4-B | ユーザー管理（管理者） | ユーザー一覧 | GET /admin/users | 1 | [ ] |
| 5 | API監視・統計 | 使用量・コスト監視 | GET /users/me/api-usage, GET /admin/api-monitor/stats | 3-A | [ ] |

**※ 番号-アルファベット表記（2-A, 2-B等）は並列実装可能を示す**

### 2.2 エンドポイント実装タスクリスト

#### スライス1: 認証基盤
| タスク | エンドポイント | メソッド | 説明 | 完了 |
|--------|--------------|---------|------|------|
| 1.1 | /api/v1/auth/register | POST | 新規ユーザー申請 | [ ] |
| 1.2 | /api/v1/auth/login | POST | メール/パスワードログイン | [ ] |
| 1.3 | /api/v1/users/me | GET | 現在のユーザー情報取得 | [ ] |
| 1.4 | データベース: Users | - | Usersテーブル作成 | [ ] |
| 1.5 | データベース: Applications | - | Applicationsテーブル作成 | [ ] |
| 1.6 | JWT認証ミドルウェア | - | トークン検証機能 | [ ] |
| 1.7 | パスワードハッシュ化 | - | bcrypt実装 | [ ] |

#### スライス2-A: 申請管理（管理者）
| タスク | エンドポイント | メソッド | 説明 | 完了 |
|--------|--------------|---------|------|------|
| 2A.1 | /api/v1/admin/applications | GET | 申請一覧取得 | [ ] |
| 2A.2 | /api/v1/admin/applications/{id}/approve | PUT | 申請承認 | [ ] |
| 2A.3 | /api/v1/admin/applications/{id}/reject | PUT | 申請却下 | [ ] |
| 2A.4 | メール通知機能 | - | 承認・却下通知メール送信 | [ ] |

#### スライス2-B: プロジェクト管理
| タスク | エンドポイント | メソッド | 説明 | 完了 |
|--------|--------------|---------|------|------|
| 2B.1 | /api/v1/projects | POST | 新規プロジェクト作成 | [ ] |
| 2B.2 | /api/v1/projects | GET | プロジェクト一覧取得 | [ ] |
| 2B.3 | /api/v1/projects/{id} | GET | プロジェクト詳細取得 | [ ] |
| 2B.4 | /api/v1/projects/{id} | DELETE | プロジェクト削除 | [ ] |
| 2B.5 | データベース: Projects | - | Projectsテーブル作成 | [ ] |
| 2B.6 | データベース: PhaseProgress | - | PhaseProgressテーブル作成 | [ ] |

#### スライス3-A: AI対話機能
| タスク | エンドポイント | メソッド | 説明 | 完了 |
|--------|--------------|---------|------|------|
| 3A.1 | /api/v1/projects/{id}/messages | POST | メッセージ送信（SSE） | [ ] |
| 3A.2 | /api/v1/projects/{id}/messages | GET | チャット履歴取得 | [ ] |
| 3A.3 | Claude API統合 | - | Claude API SDKセットアップ | [ ] |
| 3A.4 | SSEストリーミング実装 | - | Server-Sent Events実装 | [ ] |
| 3A.5 | プロンプトキャッシング | - | キャッシュ機能実装 | [ ] |
| 3A.6 | データベース: ChatMessages | - | ChatMessagesテーブル作成 | [ ] |
| 3A.7 | データベース: APIUsageLogs | - | APIUsageLogsテーブル作成 | [ ] |

#### スライス3-B: ユーザープロフィール
| タスク | エンドポイント | メソッド | 説明 | 完了 |
|--------|--------------|---------|------|------|
| 3B.1 | /api/v1/users/me | PUT | ユーザー情報更新 | [ ] |
| 3B.2 | APIキー暗号化 | - | Fernet暗号化実装 | [ ] |

#### スライス4-A: OAuth認証
| タスク | エンドポイント | メソッド | 説明 | 完了 |
|--------|--------------|---------|------|------|
| 4A.1 | /api/v1/auth/oauth/google | POST | Google OAuth認証 | [ ] |
| 4A.2 | /api/v1/auth/oauth/github | POST | GitHub OAuth認証 | [ ] |
| 4A.3 | OAuth設定 | - | Google/GitHub OAuth設定 | [ ] |

#### スライス4-B: ユーザー管理（管理者）
| タスク | エンドポイント | メソッド | 説明 | 完了 |
|--------|--------------|---------|------|------|
| 4B.1 | /api/v1/admin/users | GET | 全ユーザー一覧取得 | [ ] |
| 4B.2 | ユーザーステータス変更 | - | ステータス更新機能 | [ ] |

#### スライス5: API監視・統計
| タスク | エンドポイント | メソッド | 説明 | 完了 |
|--------|--------------|---------|------|------|
| 5.1 | /api/v1/users/me/api-usage | GET | ユーザーのAPI使用量取得 | [ ] |
| 5.2 | /api/v1/admin/api-monitor/stats | GET | 全体API監視統計取得 | [ ] |
| 5.3 | 使用量集計バッチ | - | 日次/月次集計処理 | [ ] |

### 2.3 並列実装スケジュール

```
Week 1: |========== スライス1 (認証基盤) ==========|
         └─ Users/Applicationsテーブル、JWT認証

Week 2: |====== スライス2-A (申請管理) ======|
        |====== スライス2-B (プロジェクト) ======|  ← 並列実装
         └─ 異なるテーブル操作で競合なし

Week 3: |===== スライス3-A (AI対話) =====|
        |===== スライス3-B (プロフィール) =====|   ← 並列実装
         └─ 3-Aはメッセージ、3-Bはユーザー情報

Week 4: |=== 4-A (OAuth) ===|=== 4-B (管理) ===|  ← 並列実装
        |======= スライス5 (API監視) =======|
```

### 2.4 実装の重要ポイント

#### データベース設計
```yaml
必須テーブル:
  - Users: ユーザー情報
  - Applications: 申請情報
  - Projects: プロジェクト情報
  - PhaseProgress: Phase進捗状況
  - ChatMessages: チャットメッセージ
  - APIUsageLogs: API使用ログ
  - GeneratedCode: 生成されたコード（Phase 2で使用）
```

#### セキュリティ実装
```yaml
認証:
  - JWTトークン（24時間有効期限）
  - bcryptパスワードハッシュ化
  - リフレッシュトークン実装

暗号化:
  - APIキー: Fernet対称暗号化
  - 環境変数: .envファイル管理

アクセス制御:
  - 管理者専用エンドポイントの権限チェック
  - ユーザー自身のリソースのみアクセス可能
```

#### API設計原則
```yaml
エラーハンドリング:
  - 統一エラーレスポンス形式
  - 適切なHTTPステータスコード
  - エラーコード定義

バリデーション:
  - Pydanticモデル活用
  - 入力値検証
  - SQLインジェクション対策（SQLAlchemy ORM）

パフォーマンス:
  - プロンプトキャッシング（50%コスト削減）
  - データベースインデックス最適化
  - N+1クエリ対策
```

### 2.5 実装順序の厳守事項

1. **スライス1（認証基盤）を必ず最初に完成させる**
   - 全機能の前提条件
   - JWT認証ミドルウェアが他で必要

2. **番号-アルファベット表記（2-A, 2-B等）は並列実装可能**
   - テーブル競合なし
   - 依存関係が独立

3. **スライスの依存関係を確認し、前提条件を満たす**
   - 3-Aは2-B完了後に開始
   - 5は3-A完了後に開始（APIUsageLogsテーブルが必要）

---

## 開発タスク管理

### 基盤構築（Day 1-2）

| タスク | 担当 | 優先度 | 着手 | 完了 |
|-------|------|-------|------|------|
| GitHubリポジトリ作成 | Dev | 高 | [ ] | [ ] |
| フロントエンド雛形（React + MUI） | Dev | 高 | [ ] | [ ] |
| バックエンド雛形（FastAPI） | Dev | 高 | [ ] | [ ] |
| Neon PostgreSQL接続 | Dev | 高 | [ ] | [ ] |
| 基本認証実装（JWT） | Dev | 高 | [ ] | [ ] |

### 認証・ユーザー管理（Day 3-4）

| タスク | 担当 | 優先度 | 着手 | 完了 |
|-------|------|-------|------|------|
| P-002: 申請フォーム実装 | Dev | 高 | [ ] | [ ] |
| P-003: ログインページ実装 | Dev | 高 | [ ] | [ ] |
| P-007: 審査待ちページ実装 | Dev | 中 | [ ] | [ ] |
| A-001: 申請審査ダッシュボード実装 | Dev | 高 | [ ] | [ ] |
| メール通知機能実装 | Dev | 高 | [ ] | [ ] |
| OAuth連携（Google/GitHub） | Dev | 中 | [ ] | [ ] |

### コア機能（Day 5-7）

| タスク | 担当 | 優先度 | 着手 | 完了 |
|-------|------|-------|------|------|
| P-004: プロジェクト一覧実装 | Dev | 高 | [ ] | [ ] |
| P-005: PhaseカードUI実装 | Dev | 高 | [ ] | [ ] |
| Claude API統合 | Dev | 高 | [ ] | [ ] |
| SSEストリーミング実装 | Dev | 高 | [ ] | [ ] |
| Phase 1エージェント（要件定義） | Dev | 高 | [ ] | [ ] |
| Phase 2エージェント（コード生成） | Dev | 高 | [ ] | [ ] |
| Phase 3エージェント（デプロイ） | Dev | 高 | [ ] | [ ] |
| プロンプトキャッシング実装 | Dev | 高 | [ ] | [ ] |
| Monaco Editor統合 | Dev | 中 | [ ] | [ ] |

### 管理機能・デプロイ（Day 8-9）

| タスク | 担当 | 優先度 | 着手 | 完了 |
|-------|------|-------|------|------|
| P-006: マイプロフィール実装 | Dev | 中 | [ ] | [ ] |
| A-002: ユーザー管理実装 | Dev | 高 | [ ] | [ ] |
| A-003: API監視ダッシュボード実装 | Dev | 高 | [ ] | [ ] |
| 自動デプロイ機能実装 | Dev | 高 | [ ] | [ ] |
| Vercel/GCR連携 | Dev | 高 | [ ] | [ ] |
| GitHub Actions設定 | Dev | 高 | [ ] | [ ] |

### テスト・調整（Day 10）

| タスク | 担当 | 優先度 | 着手 | 完了 |
|-------|------|-------|------|------|
| 統合テスト実施 | Dev | 高 | [ ] | [ ] |
| バグ修正 | Dev | 高 | [ ] | [ ] |
| パフォーマンス最適化 | Dev | 中 | [ ] | [ ] |
| ドキュメント整備 | Dev | 中 | [ ] | [ ] |

### 自己改善機能・仕上げ（Day 11-14）

| タスク | 担当 | 優先度 | 着手 | 完了 |
|-------|------|-------|------|------|
| Phase 4エージェント（自己改善）実装 | Dev | 高 | [ ] | [ ] |
| P-001: ランディングページ実装 | Dev | 中 | [ ] | [ ] |
| 最終テスト | Dev | 高 | [ ] | [ ] |
| 本番デプロイ | Dev | 高 | [ ] | [ ] |
| ユーザー受け入れ準備 | Dev | 中 | [ ] | [ ] |

---

## 進捗サマリー

### MVP（10-14日）進捗

- **総ページ数**: 10ページ
- **完了ページ**: 0/10
- **総Phase数**: 4Phase
- **完了Phase**: 0/4
- **総タスク数**: 40タスク
- **完了タスク**: 0/40
- **進捗率**: 0%

### 今後の拡張候補

#### 機能拡張
- [ ] OpenAI API統合（フォールバック）
- [ ] Redis統合（キャッシュ強化）
- [ ] Stripe統合（決済）
- [ ] モバイルアプリ対応（Flutter）
- [ ] VSCode拡張機能
- [ ] AI/ML統合機能

#### Phase拡張
- [ ] Phase 5: テストエージェント
- [ ] Phase 6: リファクタリングエージェント
- [ ] Phase 7: ドキュメント生成エージェント
- [ ] Phase 8-14+: ユーザーニーズに応じた拡張

#### ページ拡張
- [ ] A-004: システム設定
- [ ] P-008: プロジェクトテンプレート共有
- [ ] P-009: チーム協業機能
- [ ] P-010: 統計ダッシュボード

---

**最終更新日**: 2025年11月5日
**バージョン**: 1.0
