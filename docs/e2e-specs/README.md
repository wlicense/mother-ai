# マザーAI - E2Eテスト仕様書（MVP完全版）

## 概要

本ドキュメントは、マザーAI MVP 10ページの全E2Eテスト項目を定義します。

**生成日**: 2025年11月6日
**バージョン**: 2.0
**テストフレームワーク**: Playwright
**技術スタック**: React 18 + TypeScript, FastAPI, Neon PostgreSQL

---

## テストケース命名規則

```
E2E-[ページID]-[連番]

例:
- E2E-P001-001: ランディングページ表示
- E2E-P002-001: 申請フォーム送信成功
- E2E-A001-001: 申請一覧表示
```

---

## 1. P-001: ランディングページ (`/`)

### 正常系テスト

#### E2E-P001-001: ランディングページ表示
**前提条件**
- なし（ゲストアクセス）

**テスト手順**
1. `/` にアクセス

**期待結果**
- サービス説明が表示される
- デモ動画・スクリーンショットが表示される
- 「申請する」ボタンが表示される
- 「ログイン」リンクが表示される

#### E2E-P001-002: 申請フォームへ遷移
**テスト手順**
1. `/` にアクセス
2. 「申請する」ボタンをクリック

**期待結果**
- `/apply` にリダイレクト

#### E2E-P001-003: ログインページへ遷移
**テスト手順**
1. `/` にアクセス
2. 「ログイン」リンクをクリック

**期待結果**
- `/login` にリダイレクト

### UIテスト

#### E2E-P001-101: レスポンシブデザイン検証
**テスト手順**
1. デスクトップ (1920x1080) で表示
2. タブレット (768x1024) で表示
3. モバイル (375x667) で表示

**期待結果**
- 全デバイスで正しくレイアウト表示
- モバイルでタップ可能なボタンサイズ

---

## 2. P-002: 申請フォーム (`/apply`)

### 正常系テスト

#### E2E-P002-001: 申請フォーム送信成功
**テスト手順**
1. `/apply` にアクセス
2. メールアドレス入力: `test-apply@example.com`
3. 氏名入力: `テストユーザー`
4. パスワード入力: `SecurePassword123!`
5. パスワード確認入力: `SecurePassword123!`
6. 利用目的入力: `フリーランスエンジニアとして大規模案件を受注するため、マザーAIを活用して開発スキルを向上させたいと考えています。`
7. 経験レベル選択: `完全初心者`
8. 「申請を送信」ボタンをクリック

**期待結果**
- 申請完了メッセージ表示
- `/pending` ページにリダイレクト

#### E2E-P002-002: Google OAuth連携で申請
**テスト手順**
1. `/apply` にアクセス
2. 「Googleで申請」ボタンをクリック
3. Google OAuth フローを完了
4. 利用目的等の追加情報を入力
5. 申請送信

**期待結果**
- OAuth認証成功
- 申請完了
- `/pending` にリダイレクト

#### E2E-P002-003: GitHub OAuth連携で申請
**テスト手順**
1. `/apply` にアクセス
2. 「GitHubで申請」ボタンをクリック
3. GitHub OAuth フローを完了
4. 利用目的等の追加情報を入力
5. 申請送信

**期待結果**
- OAuth認証成功
- 申請完了
- `/pending` にリダイレクト

### 異常系テスト

#### E2E-P002-101: 利用目的が短すぎる
**テスト手順**
1. 利用目的に30文字未満を入力: `テストです`
2. 送信試行

**期待結果**
- エラーメッセージ表示: `利用目的は50文字以上で記入してください`
- フォーム送信されない

#### E2E-P002-102: パスワード不一致
**テスト手順**
1. パスワード: `password123`
2. パスワード確認: `differentpassword`
3. 送信試行

**期待結果**
- エラーメッセージ: `パスワードが一致しません`

#### E2E-P002-103: 無効なメールアドレス
**テスト手順**
1. メールアドレス: `invalid-email`
2. その他の項目を正しく入力
3. 送信試行

**期待結果**
- HTML5バリデーション表示
- または、エラーメッセージ: `有効なメールアドレスを入力してください`

#### E2E-P002-104: 既に登録済みのメールアドレス
**前提条件**
- `existing@example.com` が既に登録されている

**テスト手順**
1. メールアドレス: `existing@example.com`
2. その他の項目を正しく入力
3. 送信試行

**期待結果**
- エラーメッセージ: `このメールアドレスは既に登録されています`

#### E2E-P002-105: パスワード強度不足
**テスト手順**
1. パスワード: `weak` （短すぎる）
2. パスワード確認: `weak`
3. その他の項目を正しく入力
4. 送信試行

**期待結果**
- エラーメッセージ: `パスワードは8文字以上で、大文字、小文字、数字を含む必要があります`

---

## 3. P-003: ログインページ (`/login`)

### 正常系テスト

#### E2E-P003-001: メール/パスワードログイン成功
**前提条件**
- 承認済みユーザーアカウントが存在する: `test@motherai.local` / `DevTest2025!`

**テスト手順**
1. `/login` にアクセス
2. メールアドレス入力: `test@motherai.local`
3. パスワード入力: `DevTest2025!`
4. 「ログイン」ボタンをクリック

**期待結果**
- `/projects` ページにリダイレクト
- JWTトークンがlocalStorageに保存される
- ヘッダーにユーザー名が表示される

#### E2E-P003-002: Google OAuthログイン
**テスト手順**
1. `/login` にアクセス
2. 「Googleでログイン」ボタンをクリック
3. Googleログインフローを完了

**期待結果**
- OAuth認証成功
- `/projects` ページにリダイレクト

#### E2E-P003-003: GitHub OAuthログイン
**テスト手順**
1. `/login` にアクセス
2. 「GitHubでログイン」ボタンをクリック
3. GitHubログインフローを完了

**期待結果**
- OAuth認証成功
- `/projects` ページにリダイレクト

### 異常系テスト

#### E2E-P003-101: 誤ったパスワードでログイン試行
**テスト手順**
1. `/login` にアクセス
2. メールアドレス入力: `test@motherai.local`
3. パスワード入力: `WrongPassword`
4. 「ログイン」ボタンをクリック

**期待結果**
- エラーメッセージ表示: `メールアドレスまたはパスワードが正しくありません`
- ログインページに留まる

#### E2E-P003-102: 存在しないメールアドレスでログイン試行
**テスト手順**
1. メールアドレス入力: `nonexistent@example.com`
2. パスワード入力: `anypassword`
3. 「ログイン」ボタンをクリック

**期待結果**
- エラーメッセージ表示: `メールアドレスまたはパスワードが正しくありません`

#### E2E-P003-103: 審査中ユーザーのログイン試行
**前提条件**
- ステータスが `pending` のユーザーアカウントが存在する

**テスト手順**
1. 審査中ユーザーの認証情報でログイン試行

**期待結果**
- `/pending` ページにリダイレクト
- 「審査中です」メッセージ表示

#### E2E-P003-104: 停止中ユーザーのログイン試行
**前提条件**
- ステータスが `suspended` のユーザーアカウントが存在する

**テスト手順**
1. 停止中ユーザーの認証情報でログイン試行

**期待結果**
- エラーメッセージ表示: `アカウントが停止されています。詳細はサポートまでお問い合わせください`

#### E2E-P003-105: 却下されたユーザーのログイン試行
**前提条件**
- ステータスが `rejected` の申請が存在する

**テスト手順**
1. 却下された申請のメールアドレスでログイン試行

**期待結果**
- エラーメッセージ表示: `申請が却下されました。詳細はメールをご確認ください`

### UIテスト

#### E2E-P003-201: レスポンシブデザイン検証
**テスト手順**
1. デスクトップ (1920x1080) で表示
2. タブレット (768x1024) で表示
3. モバイル (375x667) で表示

**期待結果**
- 全デバイスで正しくレイアウト表示
- モバイルでタップ可能なボタンサイズ

#### E2E-P003-202: バリデーション表示
**テスト手順**
1. メールアドレスに無効な値を入力: `invalid-email`
2. フォーム送信試行

**期待結果**
- ブラウザのHTML5バリデーション表示

---

## 4. P-004: プロジェクト一覧・管理 (`/projects`)

### 正常系テスト

#### E2E-P004-001: プロジェクト一覧表示
**前提条件**
- ログイン済み
- ユーザーが3つのプロジェクトを所有

**テスト手順**
1. `/projects` にアクセス

**期待結果**
- 3つのプロジェクトカードが表示される
- 各カードに以下が表示:
  - プロジェクト名
  - 進捗率
  - 現在のPhase情報
  - 最終更新日時
  - 「開く」ボタン
  - 「削除」ボタン

#### E2E-P004-002: 新規プロジェクト作成
**テスト手順**
1. `/projects` にアクセス
2. 「新規プロジェクト作成」ボタンをクリック
3. プロジェクト名入力: `テストプロジェクト`
4. 「作成」ボタンをクリック

**期待結果**
- プロジェクトが作成される
- `/projects/{id}` にリダイレクト
- Phase 1が自動的に開始される

#### E2E-P004-003: プロジェクト削除
**前提条件**
- 削除可能なプロジェクトが存在する

**テスト手順**
1. `/projects` にアクセス
2. 任意のプロジェクトカードの「削除」ボタンをクリック
3. 確認モーダルで「削除」を確認

**期待結果**
- プロジェクトが削除される
- 一覧から消える
- 成功メッセージ表示: `プロジェクトを削除しました`

#### E2E-P004-004: プロジェクト詳細へ遷移
**テスト手順**
1. `/projects` にアクセス
2. 任意のプロジェクトカードをクリック

**期待結果**
- `/projects/{id}` にリダイレクト

#### E2E-P004-005: 空のプロジェクト一覧表示
**前提条件**
- ユーザーがプロジェクトを1つも持っていない

**テスト手順**
1. `/projects` にアクセス

**期待結果**
- 「プロジェクトがありません」メッセージ表示
- 「新規プロジェクト作成」ボタンが強調表示

### 異常系テスト

#### E2E-P004-101: 未認証アクセス
**前提条件**
- ログアウト状態

**テスト手順**
1. ログアウト状態で `/projects` にアクセス

**期待結果**
- `/login` にリダイレクト

#### E2E-P004-102: プロジェクト名が空で作成試行
**テスト手順**
1. 「新規プロジェクト作成」ボタンをクリック
2. プロジェクト名を空欄のまま「作成」をクリック

**期待結果**
- エラーメッセージ: `プロジェクト名を入力してください`
- プロジェクトは作成されない

---

## 5. P-005: AI対話・プロジェクト開発 (`/projects/:id`)

### 正常系テスト

#### E2E-P005-001: Phaseカード表示
**前提条件**
- プロジェクトが作成されている

**テスト手順**
1. `/projects/{id}` にアクセス

**期待結果**
- 4つのPhaseカードが表示される:
  - Phase 1: 要件定義
  - Phase 2: コード生成
  - Phase 3: デプロイ
  - Phase 4: 自己改善
- Phase 1のみ有効（他はロック状態）
- 各カードにアイコン、Phase名、説明が表示

#### E2E-P005-002: メッセージ送信
**テスト手順**
1. `/projects/{id}` にアクセス
2. メッセージ入力: `こんにちは、ECサイトを作りたいです`
3. 送信ボタンをクリック

**期待結果**
- ユーザーメッセージが表示される
- AI応答がストリーミング表示される（SSE）
- 応答がチャット履歴に追加される

#### E2E-P005-003: Phaseカードクリックで専門エージェント起動
**テスト手順**
1. `/projects/{id}` にアクセス
2. Phase 1カードをクリック

**期待結果**
- チャットエリアに「Phase 1: 要件定義を開始します」メッセージ表示
- 要件定義エージェントが起動
- Phase 1がハイライトされる

#### E2E-P005-004: Phase完了と次Phase解放
**前提条件**
- Phase 1が進行中

**テスト手順**
1. 要件定義を完了させる
2. 「Phase 1を完了」ボタンをクリック

**期待結果**
- Phase 1が完了マーク付きになる
- Phase 2が有効化される
- Phase 2カードがクリック可能になる

#### E2E-P005-005: コード生成（Phase 2）
**前提条件**
- Phase 2が有効化されている

**テスト手順**
1. Phase 2カードをクリック
2. コード生成を依頼

**期待結果**
- Claude APIでコード生成が開始される
- 進捗表示がリアルタイムで更新される
- 生成コードがファイルツリーに表示される
- Monaco Editorでコードプレビューが可能

#### E2E-P005-006: ファイルツリー表示とコード編集
**前提条件**
- コードが生成されている

**テスト手順**
1. ファイルツリーで任意のファイルをクリック
2. Monaco Editorでコードを編集
3. 保存

**期待結果**
- Monaco Editorでコードが表示される
- 編集が保存される
- ファイルツリーに「保存済み」マーク表示

#### E2E-P005-007: プロジェクト設定変更
**テスト手順**
1. プロジェクト設定アイコンをクリック
2. プロジェクト名を変更: `新しいプロジェクト名`
3. 保存

**期待結果**
- プロジェクト名が更新される
- 成功メッセージ表示

### 異常系テスト

#### E2E-P005-101: 未認証アクセス
**前提条件**
- ログアウト状態

**テスト手順**
1. ログアウト状態で `/projects/{id}` にアクセス

**期待結果**
- `/login` にリダイレクト

#### E2E-P005-102: 他ユーザーのプロジェクトへアクセス
**前提条件**
- ユーザーAとユーザーBが存在
- ユーザーBのプロジェクトID: `project-b-id`

**テスト手順**
1. ユーザーAでログイン
2. `/projects/project-b-id` にアクセス

**期待結果**
- 403 Forbidden エラー
- エラーメッセージ: `このプロジェクトにアクセスする権限がありません`

#### E2E-P005-103: 存在しないプロジェクトへアクセス
**テスト手順**
1. `/projects/non-existent-id` にアクセス

**期待結果**
- 404 Not Found エラー
- エラーメッセージ: `プロジェクトが見つかりません`

#### E2E-P005-104: ロックされたPhaseをクリック
**前提条件**
- Phase 1のみ完了

**テスト手順**
1. Phase 3（ロック状態）カードをクリック

**期待結果**
- クリックイベントが無効
- ツールチップ表示: `Phase 2を完了してください`

---

## 6. P-006: マイプロフィール・設定 (`/profile`)

### 正常系テスト

#### E2E-P006-001: プロフィール表示
**前提条件**
- ログイン済み

**テスト手順**
1. `/profile` にアクセス

**期待結果**
- ユーザー情報が表示される:
  - 氏名
  - メールアドレス
  - 登録日
  - 最終ログイン日時
  - プロジェクト数
  - API使用量（月次）

#### E2E-P006-002: プロフィール編集
**テスト手順**
1. `/profile` にアクセス
2. 氏名を変更: `新しい名前`
3. 「保存」ボタンをクリック

**期待結果**
- プロフィールが更新される
- 成功メッセージ表示: `プロフィールを更新しました`

#### E2E-P006-003: APIキー設定
**テスト手順**
1. `/profile` にアクセス
2. 「APIキー設定」タブをクリック
3. Claude APIキーを入力: `sk-ant-api03-xxx`
4. 「保存」ボタンをクリック

**期待結果**
- APIキーが暗号化保存される
- 成功メッセージ表示: `APIキーを設定しました`
- 保存後、キーの一部のみ表示: `sk-ant-api03-xxx...xxx`

#### E2E-P006-004: API使用量確認
**テスト手順**
1. `/profile` にアクセス
2. 「API使用量」タブをクリック

**期待結果**
- 月次使用量グラフが表示される
- プロジェクト別使用量が表示される
- コスト情報が表示される

#### E2E-P006-005: パスワード変更
**テスト手順**
1. `/profile` にアクセス
2. 「セキュリティ」タブをクリック
3. 現在のパスワード入力: `DevTest2025!`
4. 新しいパスワード入力: `NewPassword2025!`
5. 新しいパスワード確認: `NewPassword2025!`
6. 「パスワードを変更」ボタンをクリック

**期待結果**
- パスワードが更新される
- 成功メッセージ表示: `パスワードを変更しました`

#### E2E-P006-006: OAuth連携設定
**テスト手順**
1. `/profile` にアクセス
2. 「OAuth連携」セクションで「Google連携」ボタンをクリック
3. Google OAuth フローを完了

**期待結果**
- Google連携が有効になる
- 「連携済み」ステータス表示

### 異常系テスト

#### E2E-P006-101: 現在のパスワードが誤っている
**テスト手順**
1. パスワード変更時、現在のパスワードに誤った値を入力
2. 変更試行

**期待結果**
- エラーメッセージ: `現在のパスワードが正しくありません`
- パスワードは変更されない

#### E2E-P006-102: 新パスワードの強度不足
**テスト手順**
1. 新しいパスワード: `weak`
2. 変更試行

**期待結果**
- エラーメッセージ: `パスワードは8文字以上で、大文字、小文字、数字を含む必要があります`

#### E2E-P006-103: 無効なAPIキー
**テスト手順**
1. 無効なAPIキーを入力: `invalid-key`
2. 保存試行

**期待結果**
- エラーメッセージ: `無効なAPIキーです。形式を確認してください`

#### E2E-P006-104: アカウント削除（キャンセル）
**テスト手順**
1. 「アカウント削除」ボタンをクリック
2. 確認モーダルで「キャンセル」をクリック

**期待結果**
- モーダルが閉じる
- アカウントは削除されない

#### E2E-P006-105: アカウント削除（実行）
**前提条件**
- テスト用アカウントを使用

**テスト手順**
1. 「アカウント削除」ボタンをクリック
2. 確認モーダルでパスワード入力
3. 「削除」ボタンをクリック

**期待結果**
- アカウントが削除される
- ログアウトされる
- `/` にリダイレクト
- メッセージ表示: `アカウントを削除しました`

---

## 7. P-007: 審査待ちページ (`/pending`)

### 正常系テスト

#### E2E-P007-001: 審査待ちページ表示
**前提条件**
- ステータスが `pending` のユーザーアカウント

**テスト手順**
1. 審査中ユーザーでログイン
2. `/pending` に自動リダイレクト

**期待結果**
- 「審査中です」メッセージ表示
- 審査にかかる時間の目安表示: `通常1-3営業日`
- 問い合わせ先メールアドレス表示
- FAQ表示

#### E2E-P007-002: 申請内容確認
**テスト手順**
1. `/pending` にアクセス
2. 「申請内容を確認」リンクをクリック

**期待結果**
- 申請時に入力した内容が表示される（編集不可）:
  - メールアドレス
  - 氏名
  - 利用目的
  - 経験レベル

#### E2E-P007-003: FAQ表示
**テスト手順**
1. `/pending` にアクセス
2. FAQ セクションを確認

**期待結果**
- よくある質問が表示される:
  - 審査基準
  - 審査期間
  - 却下された場合の再申請

### 異常系テスト

#### E2E-P007-101: 承認済みユーザーのアクセス
**前提条件**
- ステータスが `approved` のユーザー

**テスト手順**
1. 承認済みユーザーでログイン
2. `/pending` にアクセス

**期待結果**
- `/projects` にリダイレクト

---

## 8. A-001: 申請審査ダッシュボード (`/admin/applications`)

### 正常系テスト

#### E2E-A001-001: 申請一覧表示
**前提条件**
- 管理者アカウントでログイン
- 審査待ち申請が3件存在

**テスト手順**
1. `/admin/applications` にアクセス

**期待結果**
- 審査待ち申請が3件表示される
- 各申請に以下が表示:
  - 申請者名
  - メールアドレス
  - 申請日時
  - 利用目的（抜粋）
  - 「詳細」ボタン
  - 「承認」ボタン
  - 「却下」ボタン

#### E2E-A001-002: 申請詳細表示
**テスト手順**
1. `/admin/applications` にアクセス
2. 任意の申請の「詳細」ボタンをクリック

**期待結果**
- 申請詳細モーダルが表示される
- 以下の情報が表示:
  - 申請者名
  - メールアドレス
  - 利用目的（全文）
  - 経験レベル
  - どこで知ったか
  - 申請日時

#### E2E-A001-003: 申請承認
**テスト手順**
1. `/admin/applications` にアクセス
2. 任意の申請の「承認」ボタンをクリック
3. 確認モーダルで「承認」を確認

**期待結果**
- 申請ステータスが `approved` に更新
- ユーザーアカウントが作成される
- 承認メールが申請者に送信される
- 一覧から消える（pending一覧から）
- 成功メッセージ表示: `申請を承認しました`

#### E2E-A001-004: 申請却下
**テスト手順**
1. `/admin/applications` にアクセス
2. 任意の申請の「却下」ボタンをクリック
3. 却下理由入力: `利用目的が不明確です`
4. 「却下」を確認

**期待結果**
- 申請ステータスが `rejected` に更新
- 却下理由が保存される
- 却下メールが申請者に送信される（理由含む）
- 一覧から消える
- 成功メッセージ表示: `申請を却下しました`

#### E2E-A001-005: 統計表示
**テスト手順**
1. `/admin/applications` にアクセス
2. 「統計」タブをクリック

**期待結果**
- 以下の統計が表示:
  - 申請数（総数、月次）
  - 承認率
  - 却下数
  - 平均審査時間

#### E2E-A001-006: フィルター機能
**テスト手順**
1. `/admin/applications` にアクセス
2. 日付フィルター: `過去7日間`
3. 適用

**期待結果**
- 過去7日間の申請のみ表示される

### 異常系テスト

#### E2E-A001-101: 非管理者のアクセス
**前提条件**
- 一般ユーザーでログイン

**テスト手順**
1. `/admin/applications` にアクセス

**期待結果**
- 403 Forbidden エラー
- エラーメッセージ: `管理者権限が必要です`

#### E2E-A001-102: 却下理由が空で却下試行
**テスト手順**
1. 申請を却下しようとする
2. 却下理由を空欄のまま送信

**期待結果**
- エラーメッセージ: `却下理由を入力してください`
- 却下されない

---

## 9. A-002: ユーザー・プロジェクト管理 (`/admin/users`)

### 正常系テスト

#### E2E-A002-001: 全ユーザー一覧表示
**前提条件**
- 管理者アカウントでログイン
- 10人のユーザーが存在

**テスト手順**
1. `/admin/users` にアクセス

**期待結果**
- 10人のユーザーが一覧表示される
- 各ユーザーに以下が表示:
  - ユーザー名
  - メールアドレス
  - ステータス
  - プロジェクト数
  - API使用量
  - 登録日
  - 「詳細」ボタン

#### E2E-A002-002: ユーザー詳細表示
**テスト手順**
1. `/admin/users` にアクセス
2. 任意のユーザーの「詳細」ボタンをクリック

**期待結果**
- ユーザー詳細ページに遷移
- 以下の情報が表示:
  - 基本情報（名前、メール、ステータス）
  - プロジェクト一覧
  - API使用量詳細
  - OAuth連携状況
  - 最終ログイン日時

#### E2E-A002-003: ユーザーステータス変更（停止）
**テスト手順**
1. `/admin/users` にアクセス
2. 任意のユーザーの「停止」ボタンをクリック
3. 停止理由入力: `異常なAPI使用を検知`
4. 確認

**期待結果**
- ユーザーステータスが `suspended` に更新
- 停止通知メールが送信される
- 成功メッセージ表示: `ユーザーを停止しました`

#### E2E-A002-004: ユーザーステータス変更（再開）
**前提条件**
- 停止中のユーザーが存在

**テスト手順**
1. 停止中ユーザーの詳細を表示
2. 「再開」ボタンをクリック

**期待結果**
- ユーザーステータスが `approved` に更新
- 再開通知メールが送信される
- 成功メッセージ表示: `ユーザーを再開しました`

#### E2E-A002-005: 全プロジェクト一覧表示
**テスト手順**
1. `/admin/users` にアクセス
2. 「プロジェクト」タブをクリック

**期待結果**
- 全プロジェクト一覧が表示される
- 各プロジェクトに以下が表示:
  - プロジェクト名
  - 所有者
  - Phase進捗
  - 最終更新日時
  - API使用量
  - 「詳細」ボタン

#### E2E-A002-006: プロジェクト詳細表示
**テスト手順**
1. プロジェクト一覧で任意のプロジェクトの「詳細」をクリック

**期待結果**
- プロジェクト詳細モーダルが表示される
- 以下の情報が表示:
  - プロジェクト名
  - 所有者
  - Phase進捗
  - チャット履歴
  - 生成コード（ファイルツリー）
  - API使用量

#### E2E-A002-007: スパム検出
**テスト手順**
1. `/admin/users` にアクセス
2. 「スパム検出」タブをクリック

**期待結果**
- 異常なパターンが検出される:
  - 短時間に大量プロジェクト作成
  - 異常なAPI使用量
  - 同じコード内容の繰り返し生成
- 該当ユーザー/プロジェクトがハイライト表示

#### E2E-A002-008: ユーザー削除
**前提条件**
- テスト用ユーザーアカウント

**テスト手順**
1. ユーザー詳細で「削除」ボタンをクリック
2. 確認モーダルで理由入力
3. 「削除」を確認

**期待結果**
- ユーザーとそのプロジェクトが完全削除される
- 成功メッセージ表示: `ユーザーを削除しました`

#### E2E-A002-009: 検索機能
**テスト手順**
1. `/admin/users` にアクセス
2. 検索バーにメールアドレスの一部を入力: `test@`

**期待結果**
- `test@` を含むメールアドレスのユーザーのみ表示

#### E2E-A002-010: フィルター機能
**テスト手順**
1. `/admin/users` にアクセス
2. ステータスフィルター: `suspended`

**期待結果**
- 停止中のユーザーのみ表示

### 異常系テスト

#### E2E-A002-101: 非管理者のアクセス
**前提条件**
- 一般ユーザーでログイン

**テスト手順**
1. `/admin/users` にアクセス

**期待結果**
- 403 Forbidden エラー
- エラーメッセージ: `管理者権限が必要です`

---

## 10. A-003: API監視ダッシュボード (`/admin/api-monitor`)

### 正常系テスト

#### E2E-A003-001: リアルタイム監視表示
**前提条件**
- 管理者アカウントでログイン

**テスト手順**
1. `/admin/api-monitor` にアクセス

**期待結果**
- 現在のAPI使用量が表示される:
  - 今日の使用量（トークン数、コスト）
  - 今月の使用量
  - リアルタイム更新（30秒ごと）

#### E2E-A003-002: 使用量グラフ表示
**テスト手順**
1. `/admin/api-monitor` にアクセス
2. 「グラフ」タブをクリック

**期待結果**
- 日次/週次/月次の使用量グラフが表示される
- トークン種別ごとの内訳が表示:
  - 入力トークン
  - 出力トークン
  - キャッシュヒット

#### E2E-A003-003: ユーザー別使用量ランキング
**テスト手順**
1. `/admin/api-monitor` にアクセス
2. 「ランキング」タブをクリック

**期待結果**
- API使用量の多い順にユーザーがランキング表示される
- 各ユーザーに以下が表示:
  - ユーザー名
  - 使用量（トークン数）
  - コスト
  - プロジェクト数

#### E2E-A003-004: プロジェクト別使用量
**テスト手順**
1. `/admin/api-monitor` にアクセス
2. 「プロジェクト別」タブをクリック

**期待結果**
- プロジェクト別の使用量が表示される

#### E2E-A003-005: アラート設定
**テスト手順**
1. `/admin/api-monitor` にアクセス
2. 「設定」タブをクリック
3. 日次上限設定: `$100`
4. 月次上限設定: `$2000`
5. 「保存」ボタンをクリック

**期待結果**
- アラート設定が保存される
- 成功メッセージ表示: `アラート設定を保存しました`
- システムが自動監視開始

#### E2E-A003-006: 異常検知アラート表示
**前提条件**
- 異常なAPI使用が検知されている

**テスト手順**
1. `/admin/api-monitor` にアクセス

**期待結果**
- アラートが赤色ハイライトで表示される
- アラート詳細が表示:
  - 異常なユーザー/プロジェクト
  - 使用量（通常の何倍か）
  - 検知時刻
- 管理者にメール通知が送信されている

#### E2E-A003-007: モデル別使用量分析
**テスト手順**
1. `/admin/api-monitor` にアクセス
2. 「モデル別」タブをクリック

**期待結果**
- モデル別の使用量が表示:
  - Sonnet 4.5
  - Opus 4.1
  - Haiku 4.5
- 各モデルの使用トークン数、コストが表示

#### E2E-A003-008: キャッシング効果の可視化
**テスト手順**
1. `/admin/api-monitor` にアクセス
2. 「キャッシング」タブをクリック

**期待結果**
- プロンプトキャッシングの効果が表示:
  - キャッシュヒット率
  - コスト削減効果（$XX削減）
  - キャッシュヒットトークン数

#### E2E-A003-009: エクスポート機能
**テスト手順**
1. `/admin/api-monitor` にアクセス
2. 「エクスポート」ボタンをクリック
3. 期間選択: `過去30日間`
4. 形式選択: `CSV`
5. 「ダウンロード」をクリック

**期待結果**
- CSV ファイルがダウンロードされる
- 使用量データが含まれる

### 異常系テスト

#### E2E-A003-101: 非管理者のアクセス
**前提条件**
- 一般ユーザーでログイン

**テスト手順**
1. `/admin/api-monitor` にアクセス

**期待結果**
- 403 Forbidden エラー
- エラーメッセージ: `管理者権限が必要です`

#### E2E-A003-102: 無効なアラート値設定
**テスト手順**
1. アラート設定で負の値を入力: `-100`
2. 保存試行

**期待結果**
- エラーメッセージ: `有効な金額を入力してください`
- 設定は保存されない

---

## 11. セキュリティテスト（全ページ共通）

### E2E-SEC-001: 未認証アクセス防止
**テスト手順**
1. ログアウト状態で保護されたページにアクセス:
   - `/projects`
   - `/profile`
   - `/admin/applications`

**期待結果**
- `/login` にリダイレクト

### E2E-SEC-002: XSS対策
**テスト手順**
1. プロジェクト名に `<script>alert('XSS')</script>` を入力
2. 保存
3. プロジェクト一覧を表示

**期待結果**
- スクリプトはエスケープされ、そのまま文字列として表示
- スクリプトは実行されない

### E2E-SEC-003: CSRF対策
**テスト手順**
1. 外部サイトから認証済みAPIへPOSTリクエストを送信

**期待結果**
- リクエストが拒否される
- 401 Unauthorized または 403 Forbidden エラー

### E2E-SEC-004: SQLインジェクション対策
**テスト手順**
1. プロジェクト名に `'; DROP TABLE projects; --` を入力
2. 保存

**期待結果**
- プロジェクト名として保存される
- SQLインジェクションは実行されない（SQLAlchemy ORMによる自動エスケープ）

### E2E-SEC-005: JWT有効期限チェック
**テスト手順**
1. ログイン
2. JWT有効期限（24時間）を経過させる（テスト環境では時刻を操作）
3. 保護されたページにアクセス

**期待結果**
- 401 Unauthorized エラー
- `/login` にリダイレクト
- メッセージ: `セッションが期限切れです。再度ログインしてください`

### E2E-SEC-006: パスワードハッシュ化検証
**テスト手順**
1. 新規ユーザー登録
2. データベースを直接確認

**期待結果**
- パスワードがbcryptでハッシュ化されて保存されている
- プレーンテキストは保存されていない

### E2E-SEC-007: APIキー暗号化検証
**テスト手順**
1. APIキーを設定
2. データベースを直接確認

**期待結果**
- APIキーがFernetで暗号化されて保存されている
- プレーンテキストは保存されていない

---

## 12. パフォーマンステスト

### E2E-PERF-001: ページ読み込み速度
**期待値**
- 初回ロード: 2秒以内
- 2回目以降: 1秒以内

**テスト手順**
1. 各ページにアクセス
2. Lighthouse または Performance API で測定

**期待結果**
- 全ページが期待値以内で読み込まれる

### E2E-PERF-002: API応答速度
**期待値**
- プロジェクト一覧取得: 500ms以内
- メッセージ送信: 100ms以内（ストリーミング開始まで）
- ユーザー情報取得: 200ms以内

**テスト手順**
1. 各APIエンドポイントにリクエスト
2. Network タブで応答時間を測定

**期待結果**
- 全APIが期待値以内で応答

### E2E-PERF-003: ストリーミング応答のパフォーマンス
**テスト手順**
1. AI対話でメッセージ送信
2. ストリーミング応答の初回トークン到達時間を測定

**期待結果**
- 100ms以内に初回トークンが表示される
- トークンがリアルタイムで表示される（遅延なし）

### E2E-PERF-004: 大量データの表示パフォーマンス
**前提条件**
- 100件のプロジェクトが存在

**テスト手順**
1. `/projects` にアクセス
2. スクロールパフォーマンスを測定

**期待結果**
- ページネーションまたは仮想スクロールが機能
- スムーズなスクロール（60fps維持）

---

## 13. アクセシビリティテスト

### E2E-A11Y-001: キーボードナビゲーション
**テスト手順**
1. Tab キーで全ページを巡回
2. Enter/Space キーでボタン操作

**期待結果**
- 全要素がキーボードでアクセス可能
- フォーカス順序が論理的
- フォーカス表示が明確

### E2E-A11Y-002: スクリーンリーダー対応
**テスト手順**
1. スクリーンリーダー（NVDA/JAWS）で各ページを読み上げ

**期待結果**
- 全コンテンツが適切に読み上げられる
- ARIAラベルが適切に設定されている
- ランドマークが適切に定義されている

### E2E-A11Y-003: カラーコントラスト
**テスト手順**
1. Lighthouse のアクセシビリティ監査を実行

**期待結果**
- WCAG AAレベル以上のコントラスト比
- スコア90点以上

---

## テスト実行コマンド

```bash
# 全テスト実行
npm run test:e2e

# 特定ページのみ
npm run test:e2e -- --grep "E2E-P003"

# ヘッドレスモードで実行
npm run test:e2e:headless

# スクリーンショット比較
npm run test:visual

# 特定のカテゴリのみ
npm run test:e2e -- --grep "正常系"
npm run test:e2e -- --grep "異常系"
npm run test:e2e -- --grep "セキュリティ"
```

---

## テスト項目サマリー

| ページID | ページ名 | 正常系 | 異常系 | UI/その他 | 合計 |
|---------|---------|-------|-------|----------|------|
| P-001 | ランディングページ | 3 | 0 | 1 | 4 |
| P-002 | 申請フォーム | 3 | 5 | 0 | 8 |
| P-003 | ログインページ | 3 | 5 | 2 | 10 |
| P-004 | プロジェクト一覧 | 5 | 2 | 0 | 7 |
| P-005 | AI対話・開発 | 7 | 4 | 0 | 11 |
| P-006 | プロフィール | 6 | 5 | 0 | 11 |
| P-007 | 審査待ち | 3 | 1 | 0 | 4 |
| A-001 | 申請審査 | 6 | 2 | 0 | 8 |
| A-002 | ユーザー管理 | 10 | 1 | 0 | 11 |
| A-003 | API監視 | 9 | 2 | 0 | 11 |
| SEC | セキュリティ | 7 | 0 | 0 | 7 |
| PERF | パフォーマンス | 4 | 0 | 0 | 4 |
| A11Y | アクセシビリティ | 3 | 0 | 0 | 3 |
| **合計** | | **69** | **27** | **3** | **99** |

---

**更新履歴**
- 2025-11-06: MVP 10ページ完全版作成（v2.0）
- 2025-11-06: 初版作成（v1.0）
